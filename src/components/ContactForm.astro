---
// Contact Form Component
---

<form class="contact-form" action="#" method="POST" id="contact-form">
  <div id="form-content">
    <div class="form-group">
      <label for="name" class="form-label">Name *</label>
      <input 
        type="text" 
        id="name" 
        name="name" 
        class="form-input" 
        required 
        placeholder="Your full name"
      />
      <div class="field-error" id="name-error"></div>
    </div>
    
    <div class="form-group">
      <label for="email" class="form-label">Email *</label>
      <input 
        type="email" 
        id="email" 
        name="email" 
        class="form-input" 
        required 
        placeholder="your.email@example.com"
      />
      <div class="field-error" id="email-error"></div>
    </div>
    
    <div class="form-group">
      <label for="phone" class="form-label">Phone *</label>
      <input 
        type="tel" 
        id="phone" 
        name="phone" 
        class="form-input" 
        required
        placeholder="9876543210"
      />
      <div class="field-error" id="phone-error"></div>
    </div>
    
    <div class="form-group">
      <label for="subject" class="form-label">Subject *</label>
      <input 
        type="text" 
        id="subject" 
        name="subject" 
        class="form-input" 
        required 
        placeholder="What's this about?"
      />
      <div class="field-error" id="subject-error"></div>
    </div>
    
    <div class="form-group">
      <label for="message" class="form-label">Message *</label>
      <textarea 
        id="message" 
        name="message" 
        class="form-textarea" 
        required 
        placeholder="Tell us about your query..."
        rows="5"
      ></textarea>
      <div class="field-error" id="message-error"></div>
    </div>
    
    <div class="form-actions">
      <button type="submit" class="btn btn-primary btn-lg">
        <span class="btn-text">Start The Conversation</span>
        <span class="btn-spinner" style="display: none;">Delivering Your Message...</span>
      </button>
    </div>
  </div>
  
  <div class="form-success" id="form-success" style="display: none;" role="alert">
    <p>Thank you! Your message has been sent successfully. We'll get back to you soon.</p>
  </div>

  <div class="form-error" id="form-error" style="display: none;" role="alert">
    <p>There was an error delivering your message. Please try again later or shoot us an email at <a href="mailto:contact@hack-nocturne.in">contact@hack-nocturne.in</a>.</p>
  </div>
</form>

<style>
  .contact-form {
    max-width: 600px;
    margin: 0 auto;
  }
  
  .form-group {
    margin-bottom: var(--space-4);
  }
  
  .form-label {
    display: block;
    font-weight: var(--font-weight-medium);
    font-size: var(--font-size-sm);
    color: var(--color-white);
    margin-bottom: var(--space-2);
    line-height: var(--line-height-normal);
  }
  
  .form-input,
  .form-select,
  .form-textarea {
    width: 100%;
    padding: var(--space-2) var(--space-3);
    background: var(--color-frosted);
    border: 1px solid var(--color-frosted-border);
    border-radius: var(--radius-lg);
    color: var(--color-white);
    font-size: var(--font-size-base);
    line-height: var(--line-height-normal);
  }
  
  .form-input::placeholder,
  .form-textarea::placeholder {
    color: var(--color-gray-400);
  }
  
  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
  }
  
  .form-input:invalid:not(:placeholder-shown),
  .form-select:invalid:not(:placeholder-shown),
  .form-textarea:invalid:not(:placeholder-shown),
  .form-input.error,
  .form-select.error,
  .form-textarea.error {
    border-color: #ef4444;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
  }
  
  .form-select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right var(--space-2) center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-right: var(--space-8);
    appearance: none;
  }
  
  .form-textarea {
    resize: vertical;
    min-height: 100px;
  }
  
  .form-actions {
    text-align: center;
    margin-top: var(--space-6);
  }
  
  .form-success {
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.2);
    border-radius: var(--radius-lg);
    padding: var(--space-3);
    margin-top: var(--space-4);
    text-align: center;
  }
  
  .form-success p {
    color: #22c55e;
    margin: 0;
  }

  .form-error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: var(--radius-lg);
    padding: var(--space-3);
    margin-top: var(--space-4);
    text-align: center;
  }

  .form-error p {
    color: #ef4444;
    margin: 0;
  }

  .field-error {
    color: #fca5a5;
    font-size: 0.8rem;
    margin-top: 4px;
    display: none;
  }
  
  .btn-spinner {
    display: none !important;
  }
  
  .form-submitting .btn-text {
    display: none;
  }
  
  .form-submitting .btn-spinner {
    display: inline !important;
  }
  
  .form-submitting .btn {
    opacity: 0.7;
    cursor: not-allowed;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const successMessage = document.getElementById('form-success');
    const errorMessage = document.getElementById('form-error');
    
    if (!form) return;
    
    function validateField(field: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement) {
      const value = field.value.trim();
      let errorText = "";
      
      // Check if required field is empty
      if (field.hasAttribute('required') && !value) {
        errorText = "This field is required.";
      } else if (value) {
        // Specific validation rules
        switch (field.id) {
          case 'email':
            if (!/^(?!.*\.\.)[a-zA-Z0-9._%+-]{1,64}@[a-zA-Z0-9.-]{1,253}\.[a-zA-Z]{2,}$/.test(value)) {
              errorText = "Invalid email format.";
            }
            break;
            
          case 'phone':
            if (value.length !== 10 || Number.isNaN(Number(value))) {
              errorText = "Invalid mobile number.";
            }
            break;
            
          case 'name':
            if (value.length > 25 || value.length < 3) {
              errorText = "Name should be between 3 and 25 characters.";
            }
            break;
            
          case 'subject':
            if (value.length > 50 || value.length < 6) {
              errorText = "Subject should be concise between 6 and 50 characters.";
            }
            break;
            
          case 'message':
            if (value.length > 1024 || value.length < 6) {
              errorText = "Message should be between 6 and 1024 characters.";
            }
            break;
        }
      }
      
      const errorElement = document.getElementById(`${field.id}-error`);
      
      if (errorText) {
        field.classList.add('error');
        if (errorElement) {
          errorElement.textContent = errorText;
          errorElement.style.display = 'block';
        }
        return false;
      } else {
        field.classList.remove('error');
        if (errorElement) {
          errorElement.style.display = 'none';
        }
        return true;
      }
    }
    
    const fields = form.querySelectorAll('input, select, textarea');
    fields.forEach(field => {
      field.addEventListener('blur', () => {
        validateField(field as HTMLInputElement);
      });
      
      field.addEventListener('input', () => {
        if (field.classList.contains('error')) {
          validateField(field as HTMLInputElement);
        }
      });
    });
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Prevent multiple submissions
      if (form.classList.contains('form-submitting')) {
        return;
      }
      
      let isFormValid = true;
      fields.forEach(field => {
        if (!validateField(field as HTMLInputElement)) {
          isFormValid = false;
        }
      });
      
      if (!isFormValid) {
        // Focus on first error field
        const firstErrorField = form.querySelector('.error') as HTMLElement;
        firstErrorField?.focus();
        return;
      }
      
      form.classList.add('form-submitting');
      if (errorMessage) errorMessage.style.display = 'none';
      
      try {
        const formData = new FormData(form);
        const data: any = Object.fromEntries(formData.entries());
        
        // Map phone to mobile as per API requirement
        if (data.phone) {
          data.mobile = data.phone;
          delete data.phone;
        }
        
        const response = await fetch("https://tez-aid.hack-nocturne.in", { 
          method: "POST", 
          body: JSON.stringify(data),
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        // Hide form content and show success message
        const formContent = document.getElementById('form-content');
        if (formContent) {
          formContent.style.display = 'none';
        }
        
        if (successMessage) {
          successMessage.style.display = 'block';
        }
        
        form.reset();
      } catch (error) {
        console.error('Form submission error:', error);
        if (errorMessage) {
          errorMessage.style.display = 'block';
        }
      } finally {
        form.classList.remove('form-submitting');
      }
    });
  });
</script>
